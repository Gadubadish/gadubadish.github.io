<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>TEST</title>
<style>

html{
        zoom: .6;
}

  body {
    margin: 0;
    overflow: hidden;
    background: black url(images/CRT.png) no-repeat;
    background-position: -10px 70px; /* fixed position */
    background-size: 2080px; /* keep original image size */
  }
  canvas { display: block; }
</style>
</head>
<body>



<script type="module">
import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js';



  
// --- Plane & animation flags ---
let plane; // defined later
let startupDone = false;
let SUinitiated = false;

let difficulty;
let cost;
let interiorLayout;
let mapPhoto;

// --- Fixed layout dimensions ---
const size = 1.15;
const WIDTH = 1920*size;
const HEIGHT = 1080*size;
const ASPECT = WIDTH / HEIGHT;


//DATA

const entities = {
  barber: { health: "Invincible", power: 1, max: 1, favoriteMoon: "7-Dine" },
  bracken: { health: 5, power: 3, max: 1, favoriteMoon: "56-Vow" },
  bunkerSpider: { health: 5, power: 2, max: 1, favoriteMoon: "41-Experimentation" },
  butler: { health: "2(SP*)/8(MP*)", power: 2, max: 7, favoriteMoon: "7-Dine" },
  coilHead: { health: "Invincible", power: 1, max: 5, favoriteMoon: "21-Offense" },
  ghostGirl: { health: "Invincible", power: 2, max: 1, favoriteMoon: "85-Rend" },
  hoardingBug: { health: 3, power: 1, max: 8, favoriteMoon: "5-Embrion" },
  hygrodere: { health: "Invincible", power: 1, max: 2, favoriteMoon: "21-Offense" },
  jester: { health: "Invincible", power: 3, max: 1, favoriteMoon: "85-Rend" },
  maneater: { health: 5, power: 2, max: 1, favoriteMoon: "56-Vow" },
  masked: { health: 4, power: 1, max: 10, favoriteMoon: "68-Artifice" },
  nutcracker: { health: 5, power: 1, max: 10, favoriteMoon: "85-Rend" },
  snareFlea: { health: 3, power: 1, max: 4, favoriteMoon: "220-Assurance" },
  sporeLizard: { health: "Invincible", power: 1, max: 2, favoriteMoon: "5-Embrion" },
  thumper: { health: 4, power: 3, max: 4, favoriteMoon: "21-Offense" },
  baboonHawk: { health: 4, power: 0.5, max: 15, favoriteMoon: "20-Adamance" },
  earthLeviathan: { health: "Invincible", power: 2, max: 3, favoriteMoon: "220-Assurance" },
  eyelessDog: { health: 12, power: 2, max: 8, favoriteMoon: "8-Titan" },
  forestKeeper: { health: 38, power: 3, max: 3, favoriteMoon: "56-Vow" },
  oldBird: { health: "Invincible", power: 3, max: 20, favoriteMoon: "5-Embrion" }
};

const moons = {
  gordion: { difficulty: "Safe", cost: 0, interiorLayout: "-", mapPhoto: "71-Gordion (Company Building)" },
  experimentation: { difficulty: "Easy", cost: 0, interiorLayout: "The Factory (99%)", mapPhoto: "41-Experimentation" },
  assurance: { difficulty: "Easy", cost: 0, interiorLayout: "The Factory (87%)", mapPhoto: "220-Assurance" },
  vow: { difficulty: "Easy", cost: 0, interiorLayout: "The Factory (54%)", mapPhoto: "56-Vow" },
  offense: { difficulty: "Intermediate", cost: 0, interiorLayout: "The Mineshaft (60%)", mapPhoto: "21-Offense" },
  march: { difficulty: "Intermediate", cost: 0, interiorLayout: "The Factory (100%)", mapPhoto: "61-March" },
  adamance: { difficulty: "Intermediate", cost: 0, interiorLayout: "The Factory (67%)", mapPhoto: "20-Adamance" },
  rend: { difficulty: "Hard", cost: 550, interiorLayout: "The Mansion (85%)", mapPhoto: "85-Rend" },
  dine: { difficulty: "Hard", cost: 600, interiorLayout: "The Mansion (67%)", mapPhoto: "7-Dine" },
  titan: { difficulty: "Hard", cost: 700, interiorLayout: "The Factory (64%)", mapPhoto: "8-Titan" },
  embrion: { difficulty: "-", cost: 0, interiorLayout: "-", mapPhoto: "5-Embrion" },
  artifice: { difficulty: "-", cost: 0, interiorLayout: "-", mapPhoto: "68-Artifice" }
};



// --- Audio (unchanged) ---
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
let buffer;
fetch("sfx/click.mp3")
  .then(r => r.arrayBuffer())
  .then(data => audioCtx.decodeAudioData(data))
  .then(decoded => buffer = decoded);

function playClick() {
    if (!buffer) return;
    const source = audioCtx.createBufferSource();
    source.buffer = buffer;
    source.playbackRate.value = 0.9 + Math.random() * 0.2;
    source.connect(audioCtx.destination);
    source.start();
}





// --- Scene setup ---
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(60, ASPECT, 0.1, 1000);
camera.position.z = 7;
camera.position.x = 0;

const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
renderer.setClearColor(0x000000, 0);
renderer.setSize(WIDTH, HEIGHT);
renderer.domElement.style.position = "absolute";
renderer.domElement.style.left = "-250px";
renderer.domElement.style.top = "0px";
document.body.appendChild(renderer.domElement);

// --- Terminal canvas ---
const canvas = document.createElement('canvas');
canvas.width = 1024;
canvas.height = 576;
const ctx = canvas.getContext('2d');
ctx.fillStyle = 'black';
ctx.fillRect(0, 0, canvas.width, canvas.height);
ctx.fillStyle = '#00ff00';
ctx.font = '20px monospace';
const texture = new THREE.CanvasTexture(canvas);

// --- CRT-like curved plane ---
const width = 6;
const height = 4.5;
const segmentsX = 60;
const segmentsY = 60;
const geometry = new THREE.PlaneGeometry(width, height, segmentsX, segmentsY);
const positions = geometry.attributes.position.array;
for (let i = 0; i < positions.length; i += 3) {
    const x = positions[i], y = positions[i+1];
    const r = Math.sqrt((x/(width/2))**2 + (y/(height/2))**2);
    positions[i+2] = 0.6 * Math.cos(r * Math.PI/2); 
}
geometry.attributes.position.needsUpdate = true;
geometry.computeVertexNormals();

const material = new THREE.MeshBasicMaterial({ map: texture, transparent: true });
plane = new THREE.Mesh(geometry, material);
plane.visible = false; // hide plane initially
scene.add(plane);

// --- Startup animation ---
async function startupAnimation() {


    

    plane.visible = true;
    ctx.fillStyle = 'transparent';
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    const steps = 96;
    const delay = 1;
    for (let i = 0; i < steps; i++) {
        ctx.fillStyle = `rgba(0,255,0,${i / (4*steps)})`;
        ctx.fillRect(0, 6 * i, canvas.width, 2);
        texture.needsUpdate = true;
        await new Promise(r => setTimeout(r, delay));
    }
    

    ctx.fillStyle = '#00ff00';
    ctx.shadowColor = 'rgba(0,255,0,1)';
    ctx.shadowBlur = 10; // adjust for glow intensity
 
    ctx.font = '28px monospace';
    ctx.fillText("GORDION INDUSTRIES", canvas.width/2 - 130, canvas.height/2);
    texture.needsUpdate = true;

    await new Promise(r => setTimeout(r, 250));

    renderCanvas();

}

// --- Terminal logic ---
let lines = ["yo mista wite, we got it working"];
let currentInput = "";

function renderCanvas() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    if(plane.visible)
    {
    ctx.fillStyle = '#00ff00';
    ctx.shadowColor = '#00ff00';
    ctx.shadowBlur = 15; // adjust for glow intensity

    ctx.font = '25px monospace';
    for (let i = 0; i < lines.length; i++) {
        ctx.fillText(lines[i], 10, 25 + i*25);
        
    }
    ctx.fillText("> " + currentInput + "_", 10, 30 + lines.length*25);
    
    

    ctx.shadowBlur = 0;
    drawScanlines(ctx, canvas.width, canvas.height, 6);

    }
   
    texture.needsUpdate = true;
}

function drawScanlines(ctx, canvasWidth, canvasHeight, spacing = 2) {
    ctx.strokeStyle = 'rgba(0,255,0,0.2)';
    ctx.lineWidth = 1;
    for (let y = 0; y < canvasHeight; y += spacing) {
        ctx.beginPath();
        ctx.moveTo(0, y + 0.8);
        ctx.lineTo(canvasWidth, y + 0.5);
        ctx.stroke();
    }
}

function Additional () {

        return [moons.inputValue];


}

// --- Commands ---
const commands = {
    help: () => ["Available commands:", "HELP", "STATUS", "ABOUT", "CLEAR", "entities", "MOONS"],
    status: () => ["All systems operational."],
    about: () => ["Curved CRT terminal demo."],
    entities: () => ["BARBER", "BRACKEN", "BUNKER SPIDER", "BUTLER", "COIL-HEAD", "GHOST GIRL", "HOARDING BUG", "HYGRODERE", "JESTER", "MANEATER", "MASKED", "NUTCRACKER", "SNARE FLEA", "SPORE LIZARD", "THUMPER"],
    
    //entities




    
    moons: () => ["71-GORDION", "41-EXPERIMENTATION", "220-ASSURANCE", "56-VOW", "21-OFFENSE", "61-MARCH", "20-ADAMANCE", "85-REND", "7-DINE", "8-TITAN"],
    
    //Moons
    


    clear: () => {
        lines = [];
        return ["Terminal cleared."];
    }
};

// --- Input handling ---
window.addEventListener('keydown', async (e) => {

  
    if (!startupDone) {
      if(SUinitiated) return;
        SUinitiated = true;
        await startupAnimation();
        startupDone = true;
        return;
    }else {

    if (audioCtx.state === 'suspended') audioCtx.resume();

    if (e.key.length === 1) currentInput += e.key;
    if (e.key === "Backspace") currentInput = currentInput.slice(0, -1);
    if (e.key === "Enter") {
        const inputValue = currentInput.trim();
        lines.push("> " + inputValue);
        const commandFn = commands[inputValue.toLowerCase()];
        
        if (commandFn) {
            const result = commandFn();
            if (result && result.length) result.forEach(line => lines.push(line));
        } else if(inputValue in moons) {

            lines.push(moons[inputValue].difficulty);
            lines.push(moons[inputValue].cost);
            lines.push(moons[inputValue].interiorLayout);
            lines.push(moons[inputValue].mapPhoto);

        } else if (inputValue in entities) {

            lines.push(entities[inputValue].health);
            lines.push(entities[inputValue].power);
            lines.push(entities[inputValue].max);
            lines.push(entities[inputValue].favoriteMoon);

        }else if (inputValue !== "") {
            lines.push("Unknown command: " + inputValue);
        }
        currentInput = "";
        if (lines.length > 21) lines = lines.slice(lines.length-21);
        
    }
    
    

    playClick();
    renderCanvas();
    
  }

});

renderCanvas();

// --- Render loop ---
function animate() {
    requestAnimationFrame(animate);
    renderer.render(scene, camera);
}
animate();
</script>
</body>
</html>
